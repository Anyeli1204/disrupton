<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Garant√≠a de Ubicaci√≥n - Disrupton</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h2 {
            color: #555;
            margin-top: 0;
        }
        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .test-case h3 {
            margin-top: 0;
            color: #007bff;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #218838;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        .location-info {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Garant√≠a de Ubicaci√≥n - Disrupton</h1>
        <p><strong>Objetivo:</strong> Verificar que TODOS los objetos culturales se creen con informaci√≥n de ubicaci√≥n, sin excepciones.</p>
        
        <div class="test-section">
            <h2>üìã Casos de Prueba</h2>
            
            <div class="test-case">
                <h3>‚úÖ Caso 1: Sin informaci√≥n de ubicaci√≥n</h3>
                <p>Env√≠a un objeto cultural sin especificar ubicaci√≥n. Debe usar geolocalizaci√≥n autom√°tica por defecto.</p>
                <button onclick="testNoLocation()">Probar Sin Ubicaci√≥n</button>
                <div id="result1" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>‚úÖ Caso 2: Solo coordenadas</h3>
                <p>Env√≠a un objeto cultural solo con coordenadas GPS. Debe obtener direcci√≥n completa.</p>
                <button onclick="testCoordinatesOnly()">Probar Solo Coordenadas</button>
                <div id="result2" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>‚úÖ Caso 3: Solo direcci√≥n</h3>
                <p>Env√≠a un objeto cultural solo con direcci√≥n. Debe obtener coordenadas GPS.</p>
                <button onclick="testAddressOnly()">Probar Solo Direcci√≥n</button>
                <div id="result3" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>‚úÖ Caso 4: Geolocalizaci√≥n autom√°tica expl√≠cita</h3>
                <p>Env√≠a un objeto cultural con autoLocation=true. Debe usar IP geolocalizaci√≥n.</p>
                <button onclick="testAutoLocation()">Probar Geolocalizaci√≥n Autom√°tica</button>
                <div id="result4" class="result" style="display: none;"></div>
            </div>
            
            <div class="test-case">
                <h3>‚úÖ Caso 5: Simular error de geolocalizaci√≥n</h3>
                <p>Simula un error en geolocalizaci√≥n. Debe usar ubicaci√≥n por defecto.</p>
                <button onclick="testErrorFallback()">Probar Fallback por Error</button>
                <div id="result5" class="result" style="display: none;"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìä Resumen de Resultados</h2>
            <div id="summary" class="result info">
                Ejecuta los casos de prueba para ver el resumen aqu√≠.
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let testResults = [];

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = content;
        }

        function extractLocationInfo(result) {
            if (!result) return 'No se pudo extraer informaci√≥n de ubicaci√≥n';
            
            const locationFields = [
                'latitude', 'longitude', 'department', 'district', 
                'street', 'city', 'country', 'postalCode', 'fullAddress'
            ];
            
            let locationInfo = 'üìç Informaci√≥n de Ubicaci√≥n:\n';
            let hasLocation = false;
            
            locationFields.forEach(field => {
                if (result[field]) {
                    locationInfo += `${field}: ${result[field]}\n`;
                    hasLocation = true;
                }
            });
            
            if (!hasLocation) {
                locationInfo += '‚ùå NO SE DETECT√ì INFORMACI√ìN DE UBICACI√ìN\n';
            } else {
                locationInfo += '‚úÖ Ubicaci√≥n detectada correctamente\n';
            }
            
            return locationInfo;
        }

        function updateSummary() {
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.passed).length;
            const failedTests = totalTests - passedTests;
            
            let summary = `üìä RESUMEN DE PRUEBAS\n`;
            summary += `Total de pruebas: ${totalTests}\n`;
            summary += `‚úÖ Exitosas: ${passedTests}\n`;
            summary += `‚ùå Fallidas: ${failedTests}\n\n`;
            
            testResults.forEach((result, index) => {
                summary += `${index + 1}. ${result.name}: ${result.passed ? '‚úÖ PAS√ì' : '‚ùå FALL√ì'}\n`;
                if (result.error) {
                    summary += `   Error: ${result.error}\n`;
                }
            });
            
            document.getElementById('summary').textContent = summary;
        }

        async function testNoLocation() {
            try {
                showResult('result1', 'Enviando objeto sin ubicaci√≥n...', 'info');
                
                const formData = new FormData();
                formData.append('name', 'Objeto Sin Ubicaci√≥n');
                formData.append('description', 'Prueba de objeto sin especificar ubicaci√≥n');
                formData.append('origin', 'Lima, Per√∫');
                formData.append('culturalType', 'ARTESANIA');
                formData.append('region', 'Lima');
                formData.append('userId', '1');
                formData.append('fileFormat', 'GLB');
                
                // Crear archivos de imagen dummy
                const dummyImage = new File(['dummy'], 'test.jpg', { type: 'image/jpeg' });
                for (let i = 0; i < 20; i++) {
                    formData.append('imagesFiles', dummyImage);
                }

                const response = await fetch(`${API_BASE}/cultural/upload-object`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    const locationInfo = extractLocationInfo(result);
                    const hasLocation = result.latitude && result.longitude;
                    
                    testResults.push({
                        name: 'Sin informaci√≥n de ubicaci√≥n',
                        passed: hasLocation,
                        error: hasLocation ? null : 'No se asign√≥ ubicaci√≥n'
                    });
                    
                    showResult('result1', locationInfo, hasLocation ? 'success' : 'error');
                } else {
                    const error = await response.json();
                    testResults.push({
                        name: 'Sin informaci√≥n de ubicaci√≥n',
                        passed: false,
                        error: error.message
                    });
                    showResult('result1', `Error: ${error.message}`, 'error');
                }
            } catch (error) {
                testResults.push({
                    name: 'Sin informaci√≥n de ubicaci√≥n',
                    passed: false,
                    error: error.message
                });
                showResult('result1', `Error de conexi√≥n: ${error.message}`, 'error');
            }
            updateSummary();
        }

        async function testCoordinatesOnly() {
            try {
                showResult('result2', 'Enviando objeto solo con coordenadas...', 'info');
                
                const formData = new FormData();
                formData.append('name', 'Objeto Con Coordenadas');
                formData.append('description', 'Prueba de objeto solo con coordenadas GPS');
                formData.append('origin', 'Cusco, Per√∫');
                formData.append('culturalType', 'ARQUITECTURA');
                formData.append('region', 'Cusco');
                formData.append('userId', '1');
                formData.append('fileFormat', 'GLB');
                formData.append('latitude', '-13.5167');
                formData.append('longitude', '-71.9789');
                
                const dummyImage = new File(['dummy'], 'test.jpg', { type: 'image/jpeg' });
                for (let i = 0; i < 20; i++) {
                    formData.append('imagesFiles', dummyImage);
                }

                const response = await fetch(`${API_BASE}/cultural/upload-object`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    const locationInfo = extractLocationInfo(result);
                    const hasLocation = result.latitude && result.longitude && result.fullAddress;
                    
                    testResults.push({
                        name: 'Solo coordenadas',
                        passed: hasLocation,
                        error: hasLocation ? null : 'No se obtuvo informaci√≥n completa'
                    });
                    
                    showResult('result2', locationInfo, hasLocation ? 'success' : 'error');
                } else {
                    const error = await response.json();
                    testResults.push({
                        name: 'Solo coordenadas',
                        passed: false,
                        error: error.message
                    });
                    showResult('result2', `Error: ${error.message}`, 'error');
                }
            } catch (error) {
                testResults.push({
                    name: 'Solo coordenadas',
                    passed: false,
                    error: error.message
                });
                showResult('result2', `Error de conexi√≥n: ${error.message}`, 'error');
            }
            updateSummary();
        }

        async function testAddressOnly() {
            try {
                showResult('result3', 'Enviando objeto solo con direcci√≥n...', 'info');
                
                const formData = new FormData();
                formData.append('name', 'Objeto Con Direcci√≥n');
                formData.append('description', 'Prueba de objeto solo con direcci√≥n');
                formData.append('origin', 'Arequipa, Per√∫');
                formData.append('culturalType', 'GASTRONOMIA');
                formData.append('region', 'Arequipa');
                formData.append('userId', '1');
                formData.append('fileFormat', 'GLB');
                formData.append('address', 'Plaza de Armas, Arequipa, Per√∫');
                
                const dummyImage = new File(['dummy'], 'test.jpg', { type: 'image/jpeg' });
                for (let i = 0; i < 20; i++) {
                    formData.append('imagesFiles', dummyImage);
                }

                const response = await fetch(`${API_BASE}/cultural/upload-object`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    const locationInfo = extractLocationInfo(result);
                    const hasLocation = result.latitude && result.longitude;
                    
                    testResults.push({
                        name: 'Solo direcci√≥n',
                        passed: hasLocation,
                        error: hasLocation ? null : 'No se obtuvieron coordenadas'
                    });
                    
                    showResult('result3', locationInfo, hasLocation ? 'success' : 'error');
                } else {
                    const error = await response.json();
                    testResults.push({
                        name: 'Solo direcci√≥n',
                        passed: false,
                        error: error.message
                    });
                    showResult('result3', `Error: ${error.message}`, 'error');
                }
            } catch (error) {
                testResults.push({
                    name: 'Solo direcci√≥n',
                    passed: false,
                    error: error.message
                });
                showResult('result3', `Error de conexi√≥n: ${error.message}`, 'error');
            }
            updateSummary();
        }

        async function testAutoLocation() {
            try {
                showResult('result4', 'Enviando objeto con geolocalizaci√≥n autom√°tica...', 'info');
                
                const formData = new FormData();
                formData.append('name', 'Objeto Geolocalizaci√≥n Autom√°tica');
                formData.append('description', 'Prueba de objeto con geolocalizaci√≥n autom√°tica');
                formData.append('origin', 'Trujillo, Per√∫');
                formData.append('culturalType', 'MUSICA');
                formData.append('region', 'La Libertad');
                formData.append('userId', '1');
                formData.append('fileFormat', 'GLB');
                formData.append('autoLocation', 'true');
                
                const dummyImage = new File(['dummy'], 'test.jpg', { type: 'image/jpeg' });
                for (let i = 0; i < 20; i++) {
                    formData.append('imagesFiles', dummyImage);
                }

                const response = await fetch(`${API_BASE}/cultural/upload-object`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    const locationInfo = extractLocationInfo(result);
                    const hasLocation = result.latitude && result.longitude;
                    
                    testResults.push({
                        name: 'Geolocalizaci√≥n autom√°tica',
                        passed: hasLocation,
                        error: hasLocation ? null : 'No se obtuvo ubicaci√≥n autom√°tica'
                    });
                    
                    showResult('result4', locationInfo, hasLocation ? 'success' : 'error');
                } else {
                    const error = await response.json();
                    testResults.push({
                        name: 'Geolocalizaci√≥n autom√°tica',
                        passed: false,
                        error: error.message
                    });
                    showResult('result4', `Error: ${error.message}`, 'error');
                }
            } catch (error) {
                testResults.push({
                    name: 'Geolocalizaci√≥n autom√°tica',
                    passed: false,
                    error: error.message
                });
                showResult('result4', `Error de conexi√≥n: ${error.message}`, 'error');
            }
            updateSummary();
        }

        function testErrorFallback() {
            // Simulaci√≥n de test de fallback
            showResult('result5', 'Simulando error de geolocalizaci√≥n...\n\n' +
                '‚úÖ El sistema est√° configurado para usar ubicaci√≥n por defecto (Lima, Per√∫) en caso de error.\n\n' +
                'üìç Ubicaci√≥n por defecto:\n' +
                'Latitud: -12.0464\n' +
                'Longitud: -77.0428\n' +
                'Ciudad: Lima\n' +
                'Pa√≠s: Per√∫\n' +
                'Direcci√≥n: Lima, Per√∫ (ubicaci√≥n por defecto)\n\n' +
                'Este fallback garantiza que SIEMPRE haya informaci√≥n de ubicaci√≥n.', 'success');
            
            testResults.push({
                name: 'Fallback por error',
                passed: true,
                error: null
            });
            updateSummary();
        }
    </script>
</body>
</html> 